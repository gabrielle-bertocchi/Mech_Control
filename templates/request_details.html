{% extends "_layout.html" %}
{% block title %}Request Details{% endblock %}

{% block content %}
<!-- Conteúdo principal com scroll e padding para header fixo -->
<div class="flex-1 overflow-auto pt-[150px] pb-24">

    <!-- Header vermelho fixo -->
    <div class="w-full h-[150px] bg-[#E1071B] flex items-center justify-between px-6 fixed top-0 left-0 z-50">
        <div class="flex flex-col justify-center">
            <h1 class="text-[28px] font-extrabold text-white font-poppins">
                MechControl
            </h1>
            <h2 class="text-[15px] font-normal text-white font-poppins">
                Workshop Management System
            </h2>
        </div>

        <div class="w-[50px] h-[50px] bg-white rounded-full flex items-center justify-center shadow-md">
            <span class="text-[22px] font-semibold text-[#636161] font-poppins">
                {{ session.username[:1] | upper }}{{ session.username.split(' ')[1][:1] | upper if session.username.split(' ')|length > 1 else '' }}
            </span>
        </div>
    </div>

    <!-- Conteúdo da página -->
    <div class="p-6 max-w-4xl mx-auto">

        <a href="{{ url_for('parts_inbox') }}" class="text-red-primary mb-4 block font-poppins">
            <span class="text-xl mr-1">←</span> Back
        </a>

        <h1 class="text-2xl font-semibold mb-6 font-poppins">Part Request</h1>

        {% if request %}
        <div class="p-6 bg-white rounded-lg shadow mb-6 border-t-4 border-red-primary">
            <div class="flex justify-between items-start mb-2">
                <h3 class="text-xl font-semibold text-gray-800 font-poppins">{{ request.part }}</h3>
                <span class="text-xs font-semibold px-2 py-0.5 rounded-full 
                    {% if request.status == 'Pending' %} bg-gray-200 text-gray-700
                    {% elif request.status == 'Requested' %} bg-red-100 text-red-700
                    {% elif request.status == 'Approved' %} bg-yellow-100 text-yellow-700
                    {% elif request.status == 'Ordered' %} bg-indigo-100 text-indigo-700
                    {% elif request.status == 'Delivered' %} bg-green-100 text-green-700
                    {% else %} bg-gray-100 text-gray-700
                    {% endif %}">
                    {{ request.status }}
                </span>
            </div>
            <p class="text-sm text-gray-500 mb-2 font-poppins">{{ request.plate }} - {{ request.model }}</p>
            <p class="text-sm italic text-gray-600 border-t pt-2 font-poppins">{{ request.notes }}</p>
            {% if request.requested_by_username %}
            <p class="text-xs text-gray-400 mt-2 font-poppins">Requested by: {{ request.requested_by_username }}</p>
            {% endif %}
        </div>

        <h2 class="text-xl font-semibold mb-4 text-gray-800 font-poppins">Status Progress</h2>
<div class="flex space-x-8">
    {% set status_order = ['Pending', 'Requested', 'Approved', 'Ordered', 'Delivered'] %}
    {% for status in status_order %}
        {% set is_active = (status == request.status) %}
        {% set is_complete = (status_order.index(status) < status_order.index(request.status)) %}
        {% set is_delivered = (status == 'Delivered') %}
        
        {% set dot_color = 'bg-red-600' if is_active and not is_delivered else 'bg-green-400' if is_complete or is_delivered else 'bg-gray-300' %}
        {% set text_color = 'text-gray-900 font-semibold' if is_active and not is_delivered else 'text-gray-700' if is_complete or is_delivered else 'text-gray-400' %}

        <div class="flex flex-col items-center">
            <!-- Bolinha / Check -->
            {% if is_delivered %}
            <div class="w-6 h-6 flex items-center justify-center rounded-full bg-green-400 text-white font-bold text-sm">
                ✔
            </div>
            {% else %}
            <div class="w-5 h-5 rounded-full {{ dot_color }}"></div>
            {% endif %}

            <!-- Texto -->
            <p class="mt-2 text-sm {{ text_color }} font-poppins text-center">
                {{ status }}
            </p>

            {% if is_active and not is_delivered %}
            <p class="text-xs text-red-600 font-poppins mt-1">Active</p>
            {% endif %}
        </div>
    {% endfor %}
</div>


        <h2 class="text-xl font-semibold mb-4 mt-8 text-gray-800 font-poppins">Update Status</h2>
        {% if session.role == 'Parts' or session.role == 'Manager' %}
        <form method="POST" class="flex flex-col gap-4">
            <div>
                <label for="new_status" class="block text-gray-700 font-semibold mb-1 font-poppins">New Status</label>
                <select id="new_status" name="status" class="w-full p-3 border border-gray-300 rounded-lg focus:border-red-primary font-poppins">
                    <option value="Pending" {% if request.status == 'Pending' %}selected{% endif %}>Pending</option>
                    <option value="Requested" {% if request.status == 'Requested' %}selected{% endif %}>Requested</option>
                    <option value="Approved" {% if request.status == 'Approved' %}selected{% endif %}>Approved</option>
                    <option value="Ordered" {% if request.status == 'Ordered' %}selected{% endif %}>Ordered</option>
                    <option value="Delivered" {% if request.status == 'Delivered' %}selected{% endif %}>Delivered</option>
                </select>
            </div>
            
            <div class="mt-4">
                <button type="submit" class="w-full py-3 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition duration-200 font-semibold font-poppins">
                    Update Status
                </button>
            </div>
        </form>
        {% else %}
        <p class="text-sm text-gray-500 italic font-poppins">Only Parts staff or Manager can update the status.</p>
        {% endif %}
        
        {% else %}
        <p class="text-gray-600 font-poppins">Request not found.</p>
        {% endif %}

    </div>
</div>
{% endblock %}

{% block navbar %}
{% include 'navbar.html' %} 
{% endblock %}

{% block footer %}
<footer class="bg-gray-100 p-4 text-center text-gray-600 font-poppins">
    Meu Footer
</footer>
{% endblock %}
